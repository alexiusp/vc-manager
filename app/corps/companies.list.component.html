<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">
      <button type="button" class="btn btn-default btn-xs pull-left" (click)="selectAll();">
        <i class="glyphicon"  [ngClass]="{'glyphicon-check': !allSelected, 'glyphicon-unchecked': allSelected}"></i>
      </button>&nbsp;
      Companies&nbsp;({{companies?.length}})
      <button type="button" class="btn btn-default btn-xs pull-right" (click)="openList()">
        <i class="fa" [ngClass]="{'fa-minus': isListOpen, 'fa-plus': !isListOpen}"></i>
      </button>
    </h3>
  </div>
  <ul class="list-group" *ngIf="isListOpen">
    <li class="list-group-item list-group-item-info" *ngIf="!_companies || _companies.length == 0">
      <i class="fa fa-spinner fa-pulse"></i>Loading...
    </li>
    <li class="list-group-item" *ngIf="is_manager">
      <div class="row">
        <div class="col-sm-12 col-md-4">
          <div class="dropdown">
            <button type="button" class="btn btn-default btn-sm btn-block dropdown-toggle disabled" disabled data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Filter&nbsp;
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            <ul class="dropdown-menu">
              <li><a href="#">not implemented</a></li>
            </ul>
          </div>
        </div>
        <div class="col-sm-12 col-md-4">
          <button type="button" class="btn btn-primary btn-block btn-sm" (click)="putAllProductionToStorage()">
            <i class="fa fa-truck"></i>&nbsp;Unload
          </button>
        </div>
        <div class="col-sm-12 col-md-4">
          <div class="input-group input-group-sm">
            <input type="text" class="form-control" placeholder="Investment" #addFundAmount (keyup)="0"/>
            <span class="input-group-btn">
              <button class="btn btn-success" type="button" (click)="addFundsToAll(addFundAmount.value);addFundAmount.value = ''">
                <i class="glyphicon glyphicon-usd"></i>&nbsp;Invest
              </button>
            </span>
          </div>
        </div>
      </div>
    </li>
  </ul>
  <template ngFor #c [ngForOf]="companies" *ngIf="isListOpen">
    <div class="list-group" [ngClass]="{'selected-company': c.isSelected}"
      [company-info]="c"
      (on-select)="selectOne(c)"
      (on-open)="openOne(c)">
    </div>
    <div class="list-group" [ngClass]="{'selected-company': c.isSelected}"
      *ngIf="c.isOpen"
      [company-detail]="details[c.item.id]"
      [is-manager]="is_manager"
      (on-invest)="invest(c, $event)"
      (on-unload)="uloadProduction(c.item)"
      >
    </div>
    <div *ngIf="c.isOpen && is_manager && !!storages && !!storages[c.item.id]"
      [company-storage]="storages[c.item.id]"
      (on-change)="companyStorageChange(c.item.id, $event)"
      class="list-group" [ngClass]="{'selected-company': c.isSelected}">
    </div>
  </template>
  <div class="panel-footer" *ngIf="isListOpen">
    <button (click)="scroll()" type="button" class="btn btn-default btn-xs"><i class="glyphicon glyphicon-triangle-top"></i> To top</button>
  </div>
</div>
